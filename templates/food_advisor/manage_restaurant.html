{% extends 'base.html' %}
{% load static %}

{% block title %}
    Food Advisor - {{ restaurant.name }} (Manager Interface)
{% endblock title %}

{% block content %}
    {% if restaurant %}
        <div class="container mt-5">
            <h2>Manage Restaurant Information</h2>
            <form enctype="multipart/form-data" id="restaurant_manage_form" method="post" action="{% url 'food_advisor:manage_restaurant' restaurant.id %}" class="needs-validation" novalidate>
                {% csrf_token %}
                <div class="form-row">
                    {% for field in form.visible_fields %}
                        <div class="col-md-4 mb-3">
                            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                            {{ field.errors }}
                            {% if field.name == 'cuisineTypes' %}
                                <select multiple name="{{ field.name }}" class="form-control" id="{{ field.id_for_label }}">
                                    {% for cuisine in field.field.queryset %}
                                        <option value="{{ cuisine.id }}" {% if cuisine in restaurant.cuisineTypes.all %}selected{% endif %}>{{ cuisine.name }}</option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                {{ field }}
                                <div class="invalid-feedback">
                                    Please provide a valid {{ field.name }}ã€‚
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <button class="btn btn-primary" type="submit">Update Restaurant Info</button>
            </form>
            
            <!-- Dish Management -->
            <h3 class="mt-5">Manage Dishes</h3>
            <form id="add-dish-form">
                <input type="text" name="name" placeholder="Dish Name" required />
                <input type="number" name="price" placeholder="Price" required />
                <button type="submit">Add Dish</button>
            </form>
            
            <div id="dishes-list" class="mt-3">
                <h4>Current Menu</h4>
                {% for dish in dishes %}
                <div id="dish-{{ dish.id }}">
                    Name: {{ dish.name }}, Price: {{ dish.price }}
                    <button class="delete-dish-button" data-dish-id="{{ dish.id }}">Delete</button>
                </div>
                {% empty %}
                <p>No dishes yet.</p>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="alert alert-danger" role="alert">
            Restaurant does not exist.
        </div>
    {% endif %}
{% endblock content %}

{% block extra_js %}
    <script src="{% static 'js/dish_script.js' %}"></script>
{% endblock extra_js %}
